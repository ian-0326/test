<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>K-TRIP MATE Prototype</title>
  <!-- é–å®šç¸®æ”¾ -->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />

  <style>
    /* ========================
       åŸºç¤éŸ“ç³»æ¥µç°¡ä¸»é¡Œ
    ========================= */
    :root {
      --bg: #f1f2f4;
      --bg-soft: #eef0f3;
      --card-bg: rgba(255, 255, 255, 0.96);
      --card-border: rgba(209, 213, 219, 0.7);
      --primary: #1f2933;
      --primary-soft: rgba(31, 41, 51, 0.06);
      --accent: #c6a98b;
      --accent-soft: rgba(198, 169, 139, 0.12);
      --text-main: #111827;
      --text-sub: #8b9098;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.09);
      --radius-card: 24px;
      --radius-pill: 999px;
      --radius-btn: 999px;

      --weather-muted: #c1c4cc;
      --weather-accent: #b28a64;
    }

    :root[data-theme="lilac"] {
      --bg: #f4f3f7;
      --bg-soft: #ecebf3;
      --card-bg: rgba(255, 255, 255, 0.97);
      --card-border: rgba(209, 213, 219, 0.7);
      --primary: #1f2233;
      --primary-soft: rgba(31, 34, 51, 0.06);
      --accent: #b9a3df;
      --accent-soft: rgba(185, 163, 223, 0.14);
      --text-main: #111827;
      --text-sub: #9295a3;
      --shadow-soft: 0 18px 42px rgba(26, 32, 56, 0.16);

      --weather-muted: #b9bcc7;
      --weather-accent: #b9a3df;
    }

    :root[data-theme="midnight"] {
      --bg: #101119;
      --bg-soft: #161822;
      --card-bg: rgba(19, 20, 30, 0.98);
      --card-border: rgba(55, 65, 81, 0.9);
      --primary: #f0d59f;
      --primary-soft: rgba(240, 213, 159, 0.08);
      --accent: #f0d59f;
      --accent-soft: rgba(240, 213, 159, 0.1);
      --text-main: #f9fafb;
      --text-sub: #9ca3af;
      --shadow-soft: 0 22px 52px rgba(0, 0, 0, 0.72);

      --weather-muted: #7c818f;
      --weather-accent: #f0d59f;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Pretendard", "Noto Sans KR", "Noto Sans TC", system-ui, sans-serif;
      background: radial-gradient(circle at top left, #f9fafb 0, var(--bg-soft) 36%, var(--bg) 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding-bottom: 64px;
      position: relative;
    }

    /* Header */
    .app-header {
      padding: 12px 20px 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(20px);
      background: linear-gradient(
        to bottom,
        color-mix(in srgb, var(--bg) 90%, transparent),
        color-mix(in srgb, var(--bg) 78%, transparent) 70%,
        transparent
      );
    }
    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .brand-primary {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .brand-logo { font-size: 18px; }
    .brand-title {
      font-family: "SF Pro Display", "Times New Roman", serif;
      font-size: 17px;
      letter-spacing: 0.24em;
      text-transform: uppercase;
    }
    .brand-sub {
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-sub);
    }
    .header-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .status-pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: rgba(34, 197, 94, 0.08);
      color: #16a34a;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border: 1px solid rgba(22, 163, 74, 0.18);
    }
    .status-pill span { font-size: 13px; }
    .icon-btn {
      border: none;
      background: color-mix(in srgb, var(--card-bg) 80%, transparent);
      border-radius: 999px;
      padding: 6px 11px;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--text-main);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    .icon-btn span { font-size: 15px; }

    /* Top tabs */
    .top-tabs {
      display: flex;
      justify-content: center;
      gap: 26px;
      font-size: 12px;
      padding: 6px 0 8px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.18);
      position: sticky;
      top: 52px;
      z-index: 19;
      backdrop-filter: blur(14px);
      background: color-mix(in srgb, var(--bg) 92%, transparent);
    }
    .top-tab {
      position: relative;
      padding-bottom: 6px;
      color: var(--text-sub);
      cursor: pointer;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .top-tab.active {
      color: var(--text-main);
      font-weight: 500;
    }
    .top-tab.active::after {
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      width: 22px;
      height: 2px;
      border-radius: 999px;
      background: var(--accent);
    }

    main {
      flex: 1;
      padding: 14px 18px 24px;
    }
    .page { display: none; animation: fadeIn 0.2s ease-out; }
    .page.active { display: block; }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      padding: 18px 18px 16px;
      margin: 10px 0;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--card-border);
    }
    .card-hero { padding-top: 20px; padding-bottom: 20px; }

    .sub-text { font-size: 11px; color: var(--text-sub); }

    .btn-primary {
      border-radius: var(--radius-btn);
      border: none;
      background: var(--primary);
      color: #fff;
      padding: 10px 20px;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.35);
      cursor: pointer;
    }
    .btn-ghost {
      border-radius: var(--radius-btn);
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: transparent;
      padding: 8px 16px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-main);
      background: color-mix(in srgb, var(--bg) 80%, transparent);
      cursor: pointer;
    }

    .pill-outline {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 6px 11px;
      font-size: 11px;
      background: color-mix(in srgb, var(--bg-soft) 70%, var(--card-bg) 30%);
      color: var(--text-sub);
      cursor: pointer;
    }
    .pill-outline.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--text-main);
      font-weight: 500;
    }
    .pill-outline.small { padding: 4px 12px; font-size: 11px; }

    /* åŒ¯ç‡å¡ */
    .rate-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
    }
    .rate-title-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .rate-title-main {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    .rate-subtitle {
      font-size: 11px;
      color: var(--text-sub);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .rate-icon.icon-calc {
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      position: relative;
      background: radial-gradient(circle at top left, #ffffff 0, #f3f4f6 60%);
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
    }
    .rate-icon.icon-calc::before,
    .rate-icon.icon-calc::after {
      content: "";
      position: absolute;
      left: 6px;
      right: 6px;
      border-top: 1px solid rgba(209, 213, 219, 0.9);
    }
    .rate-icon.icon-calc::before { top: 9px; }
    .rate-icon.icon-calc::after { bottom: 8px; }

    .rate-switch {
      position: relative;
      display: inline-flex;
      align-items: center;
      cursor: pointer;
    }
    .rate-switch input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }
    .rate-switch-track {
      position: relative;
      width: 82px;
      height: 26px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      transition: background 0.18s ease;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }
    .rate-switch-thumb {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: #ffffff;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.25);
      transition: transform 0.18s ease;
    }
    .rate-switch-label {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: rgba(255, 255, 255, 0.9);
      pointer-events: none;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    .rate-switch-label-left { left: 10px; text-align: left; }
    .rate-switch-label-right { right: 10px; text-align: right; }
    .rate-switch input:checked + .rate-switch-track {
      background: var(--primary);
    }
    .rate-switch input:checked + .rate-switch-track .rate-switch-thumb {
      transform: translateX(48px);
    }

    .rate-body {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 6px 0 10px;
      gap: 10px;
    }
    .rate-col { flex: 1; }
    .rate-label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .rate-equal {
      width: 40px;
      text-align: center;
      font-size: 20px;
      color: var(--text-sub);
    }
    .rate-line {
      margin-top: 4px;
      height: 1px;
      width: 100%;
      background: rgba(209, 213, 219, 0.9);
    }
    .rate-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 11px;
      gap: 10px;
    }
    .rate-input-field {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      font-size: 26px;
      color: var(--text-main);
      padding: 4px 0;
      font-weight: 500;
      letter-spacing: 0.02em;
    }
    .rate-input-field::-webkit-outer-spin-button,
    .rate-input-field::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .rate-input-right { text-align: right; }

    .custom-rate-row {
      display: none;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-sub);
    }
    .custom-rate-row input {
      width: 90px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 4px 10px;
      font-size: 11px;
      background: color-mix(in srgb, var(--bg-soft) 70%, var(--card-bg) 30%);
      color: var(--text-main);
    }

    /* å¤©æ°£å¡ */
    .weather-header-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-main);
    }
    .weather-head-icon svg {
      width: 18px;
      height: 18px;
      stroke: var(--text-main);
      fill: none;
      stroke-width: 1.6;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .weather-row {
      display: flex;
      justify-content: space-between;
      text-align: center;
      font-size: 12px;
      min-height: 64px;
      margin-top: 10px;
    }
    .weather-day { flex: 1; }

    .weather-icon-svg {
      width: 26px;
      height: 26px;
      margin: 0 auto 3px;
      color: var(--weather-muted);
    }
    .weather-icon-svg.accent {
      color: var(--weather-accent);
    }
    .weather-icon-svg svg {
      width: 100%;
      height: 100%;
      stroke: currentColor;
      fill: none;
      stroke-width: 1.4;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .weather-temp-high {
      margin-top: 4px;
      font-size: 13px;
      font-weight: 500;
    }
    .weather-temp-low {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 1px;
    }

    /* segment */
    .segment-wrap {
      margin-top: 16px;
      display: flex;
      justify-content: center;
    }
    .segment {
      background: color-mix(in srgb, var(--card-bg) 90%, var(--bg-soft) 10%);
      border-radius: 999px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(209, 213, 219, 0.8);
      display: flex;
      overflow: hidden;
      width: 100%;
      max-width: 380px;
    }
    .segment-btn {
      flex: 1;
      border: none;
      padding: 11px 8px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      background: transparent;
      color: var(--text-sub);
      cursor: pointer;
    }
    .segment-btn.active {
      background: rgba(17, 24, 39, 0.95);
      color: #f9fafb;
      font-weight: 500;
    }

    /* å…¥å¢ƒæ¨¡å¼å¡ï¼ˆæ—…ä¼´åˆ—è¡¨ï¼‰ */
    .entry-header {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:10px;
      gap:10px;
    }
    .entry-title-block{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .entry-title{
      font-size:14px;
      font-weight:500;
    }
    .entry-subtitle{
      font-size:11px;
      color:var(--text-sub);
    }
    .entry-list{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .traveler-card{
      padding:10px 0 8px;
      border-top:1px solid rgba(209,213,219,0.7);
    }
    .traveler-card:first-child{
      border-top:none;
    }
    .traveler-head{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .traveler-avatar{
      width:40px;
      height:40px;
      border-radius:999px;
      background:linear-gradient(135deg,#f4f4f6,#e3e5eb);
      border:1px solid rgba(209,213,219,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:13px;
      font-weight:500;
      color:var(--text-main);
      box-shadow:0 8px 18px rgba(15,23,42,0.18);
      text-align:center;
      padding:4px;
    }
    .traveler-info{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .traveler-name{
      font-size:13px;
      font-weight:500;
    }
    .entry-upload{
      border-radius:16px;
      border:1px dashed rgba(209,213,219,0.9);
      padding:8px;
      background:color-mix(in srgb, var(--bg-soft) 60%, var(--card-bg) 40%);
    }
    .entry-preview{
      width:100%;
      border-radius:12px;
      overflow:hidden;
      background:rgba(243,244,246,0.95);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:80px;
      position:relative;
    }
    .entry-preview img{
      width:100%;
      display:block;
      object-fit:cover;
      max-height:220px;
    }
    .entry-preview-placeholder{
      font-size:11px;
      color:var(--text-sub);
    }
    .entry-upload-actions{
      margin-top:8px;
      display:flex;
      justify-content:flex-end;
    }
    .entry-upload-actions label{
      cursor:pointer;
    }

    /* Visit Japan Web èˆŠæ¨£å¼ï¼ˆæš«ä¸ç”¨ï¼Œè‹¥æœªä¾†è¦ç”¨å¯åƒè€ƒï¼‰ */
    .vjw-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
    }
    .vjw-left { display: flex; align-items: center; gap: 10px; }
    .qr-box {
      width: 28px;
      height: 28px;
      border-radius: 10px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      background: radial-gradient(circle at top left, #ffffff 0, #f3f4f6 60%);
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
    }

    /* èµ°å¤±æ¨¡å¼å¡ */
    .lost-header {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:10px;
    }
    .lost-title {
      font-size:14px;
      font-weight:500;
    }
    .lost-subtitle {
      font-size:11px;
      color:var(--text-sub);
      margin-top:2px;
    }
    .lost-status {
      font-size:11px;
      color:var(--text-sub);
      margin-top:4px;
    }
    .lost-actions {
      display:flex;
      gap:8px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .lost-feed {
      margin-top:12px;
      border-top:1px solid rgba(209,213,219,0.7);
      padding-top:8px;
      max-height:160px;
      overflow-y:auto;
    }
    .lost-feed-empty {
      font-size:11px;
      color:var(--text-sub);
    }
    .lost-item {
      font-size:11px;
      padding:6px 0;
      border-bottom:1px dashed rgba(209,213,219,0.5);
    }
    .lost-item:last-child {
      border-bottom:none;
    }
    .lost-item strong {
      font-weight:500;
    }
    .lost-item a {
      color:var(--accent);
      text-decoration:none;
      font-size:11px;
    }

    /* å…¶å®ƒåˆ†é å…±ç”¨ */
    .section-title {
      font-size: 12px;
      margin: 8px 4px 4px;
      color: var(--text-sub);
      letter-spacing: 0.14em;
      text-transform: uppercase;
    }
    .date-strip {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
      margin: 4px 0 10px;
    }
    .date-pill {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: color-mix(in srgb, var(--bg-soft) 70%, var(--card-bg) 30%);
      color: var(--text-sub);
      white-space: nowrap;
    }
    .date-pill.active {
      background: var(--primary);
      color: #f9fafb;
      border-color: var(--primary);
      font-weight: 500;
    }
    .tag-row { display:flex; flex-wrap:wrap; gap:6px; margin:6px 0 10px; }
    .tag {
      border-radius:999px;
      border:1px solid rgba(209,213,219,0.9);
      padding:4px 10px;
      font-size:11px;
      color:var(--text-sub);
      background:color-mix(in srgb, var(--bg-soft) 60%, var(--card-bg) 40%);
    }
    .card-actions-row { display:flex; gap:10px; margin-top:6px; flex-wrap:wrap; }

    .chip-grid { display:flex; gap:10px; margin:10px 0 6px; flex-wrap:wrap; }
    .chip-icon {
      flex:1; min-width:80px; text-align:center;
      padding:10px 4px;
      border-radius:18px;
      border:1px solid rgba(209,213,219,0.9);
      font-size:11px;
      color:var(--text-sub);
      background:color-mix(in srgb, var(--bg-soft) 60%, var(--card-bg) 40%);
    }
    .chip-icon.active {
      border-color:var(--accent);
      background:var(--accent-soft);
      color:var(--text-main);
      font-weight:500;
    }

    .input-row { margin-top:10px; display:flex; flex-direction:column; gap:6px; }
    .input-label { font-size:11px; color:var(--text-sub); }
    .input-field {
      border-radius:14px;
      border:1px solid rgba(209,213,219,0.9);
      padding:9px 12px;
      font-size:13px;
      width:100%;
      background:color-mix(in srgb, var(--bg-soft) 70%, var(--card-bg) 30%);
      color:var(--text-main);
    }
    .two-col { display:flex; gap:8px; margin-top:8px; }
    .pill-row { display:flex; gap:8px; margin-top:4px; flex-wrap:wrap; }

    .summary-bar {
      margin-top:12px;
      border-radius:16px;
      padding:9px 12px;
      font-size:12px;
      background:var(--accent-soft);
      color:var(--text-main);
      display:flex;
      align-items:center;
      gap:6px;
    }
    .summary-bar span { font-size:16px; }

    .progress-track{
      width:100%;height:7px;border-radius:999px;
      background:rgba(209,213,219,0.8);overflow:hidden;
    }
    .progress-fill{ height:100%;width:72%;background:var(--accent); }

    .group-header{
      display:flex;justify-content:space-between;
      align-items:center;font-size:13px;margin-bottom:8px;
    }
    .checklist{ margin-top:4px;font-size:13px; }
    .check-item{
      display:flex;align-items:center;gap:8px;margin:4px 0;
    }
    .check-item input{ width:16px;height:16px;accent-color:var(--primary); }

    /* åº•éƒ¨ nav */
    .bottom-nav-wrap{
      position:fixed;bottom:10px;left:50%;
      transform:translateX(-50%);
      width:100%;max-width:480px;
      padding:0 18px;z-index:30;pointer-events:none;
    }
    .bottom-nav{
      pointer-events:auto;
      background:color-mix(in srgb, var(--card-bg) 90%, var(--bg-soft) 10%);
      border-radius:999px;
      box-shadow:0 20px 45px rgba(15,23,42,0.22);
      border:1px solid rgba(209,213,219,0.9);
      display:flex;justify-content:space-around;
      padding:8px 14px;
    }
    .bottom-item{
      flex:1;display:flex;flex-direction:column;
      align-items:center;gap:3px;font-size:10px;color:var(--text-sub);
    }
    .bottom-item-icon{
      width:34px;height:34px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      font-size:17px;background:transparent;
    }
    .bottom-item.active .bottom-item-icon{
      background:var(--primary);color:#f9fafb;
    }
    .bottom-item.active{
      color:var(--text-main);font-weight:500;
    }

    /* Modal for æ–°å¢æ—…ä¼´ */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.35);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:40;
      backdrop-filter:blur(12px);
    }
    .modal{
      width:100%;
      max-width:320px;
      background:var(--card-bg);
      border-radius:20px;
      padding:18px 18px 14px;
      box-shadow:0 24px 60px rgba(15,23,42,0.55);
      border:1px solid var(--card-border);
    }
    .modal-title{
      font-size:15px;
      font-weight:600;
      margin-bottom:4px;
    }
    .modal-sub{
      font-size:12px;
      color:var(--text-sub);
      margin-bottom:12px;
    }
    .modal-input{
      margin-top:4px;
      margin-bottom:12px;
    }
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(4px);}
      to{opacity:1;transform:translateY(0);}
    }

    @media (prefers-color-scheme: dark) {
      :root:not([data-theme]) {
        --bg: #101119;
        --bg-soft: #161822;
        --card-bg: rgba(19, 20, 30, 0.98);
        --card-border: rgba(55, 65, 81, 0.9);
        --primary: #f0d59f;
        --primary-soft: rgba(240, 213, 159, 0.08);
        --accent: #f0d59f;
        --accent-soft: rgba(240, 213, 159, 0.1);
        --text-main: #f9fafb;
        --text-sub: #9ca3af;
        --shadow-soft: 0 22px 52px rgba(0, 0, 0, 0.72);

        --weather-muted: #7c818f;
        --weather-accent: #f0d59f;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- Header -->
    <header class="app-header">
      <div class="brand">
        <div class="brand-primary">
          <div class="brand-logo">ğŸ™ï¸</div>
          <div class="brand-title">Kâ€“TRIP</div>
        </div>
        <div class="brand-sub">SEOUL JOURNEY PLANNER</div>
      </div>
      <div class="header-right">
        <div class="status-pill">
          <span>âœ…</span> å·²è‡ªå‹•å„²å­˜
        </div>
        <button class="icon-btn" id="themeBtn">
          <span>ğŸ¨</span> PALETTE
        </button>
      </div>
    </header>

    <!-- Tabs -->
    <div class="top-tabs">
      <div class="top-tab active" data-tab="home">é¦–é </div>
      <div class="top-tab" data-tab="trip">è¡Œç¨‹</div>
      <div class="top-tab" data-tab="money">è¨˜å¸³</div>
      <div class="top-tab" data-tab="list">æ¸…å–®</div>
    </div>

    <main>
      <!-- é¦–é  -->
      <section class="page active" id="page-home">
        <!-- åŒ¯ç‡ -->
        <div class="card card-hero">
          <div class="rate-title-row">
            <div class="rate-title-left">
              <div class="rate-title-main">
                <div class="rate-icon icon-calc"></div>
                <span>åŒ¯ç‡è©¦ç®— Â· KRW â‡„ TWD</span>
              </div>
              <div class="rate-subtitle">TODAY EXCHANGE SNAPSHOT</div>
            </div>
            <label class="rate-switch">
              <input type="checkbox" id="rateModeToggle" />
              <span class="rate-switch-track">
                <span class="rate-switch-thumb"></span>
                <span class="rate-switch-label rate-switch-label-left" id="labelLive">å³æ™‚</span>
                <span class="rate-switch-label rate-switch-label-right" id="labelCustom">è‡ªè¨‚</span>
              </span>
            </label>
          </div>

          <div class="custom-rate-row" id="customRateRow">
            <span>è‡ªè¨‚åŒ¯ç‡</span>
            <span>1 TWD â‰ˆ</span>
            <input id="customRateInput" type="number" step="0.01" placeholder="45.00" />
            <span>KRW</span>
          </div>

          <div class="rate-body">
            <div class="rate-col">
              <div class="rate-label">KRW Â· éŸ“å¹£</div>
              <input id="krwInput" class="rate-input-field" type="number" inputmode="decimal" placeholder="0" />
              <div class="rate-line"></div>
            </div>
            <div class="rate-equal">ï¼</div>
            <div class="rate-col" style="text-align:right;">
              <div class="rate-label">TWD Â· å°å¹£</div>
              <input id="twdInput" class="rate-input-field rate-input-right" type="number" inputmode="decimal" placeholder="0" />
              <div class="rate-line"></div>
            </div>
          </div>

          <div class="rate-footer">
            <div class="sub-text" id="rateText">åŒ¯ç‡è¼‰å…¥ä¸­â€¦</div>
            <button class="pill-outline small" id="refreshRateBtn">åŒ¯ç‡åˆ·æ–°</button>
          </div>
        </div>

        <!-- å¤©æ°£å¡ -->
        <div class="card" id="weatherCard">
          <div class="weather-header-title">
            <span class="weather-head-icon">
              <svg viewBox="0 0 24 24">
                <!-- åœ°æ¨™ pin -->
                <path d="M12 3a5 5 0 0 0-5 5c0 3.3 3.2 6.7 4.6 8.3.3.3.7.3 1 0C13.8 14.7 17 11.3 17 8a5 5 0 0 0-5-5z"></path>
                <circle cx="12" cy="8" r="1.8"></circle>
                <path d="M7 21h10"></path>
              </svg>
            </span>
            <span>Seoul</span>
          </div>

          <div class="weather-row" id="weatherRow">
            <div class="sub-text" style="flex:1;text-align:center;">å–å¾—å¤©æ°£è³‡æ–™ä¸­â€¦</div>
          </div>
        </div>

        <!-- æ¨¡å¼åˆ‡æ›ï¼šå…¥å¢ƒ / èµ°å¤± -->
        <div class="segment-wrap">
          <div class="segment" id="modeSegment">
            <button class="segment-btn active" data-mode="entry">âœˆï¸ å…¥å¢ƒæ¨¡å¼</button>
            <button class="segment-btn" data-mode="lost">ğŸ§­ èµ°å¤±æ¨¡å¼</button>
          </div>
        </div>

        <!-- å…¥å¢ƒæ¨¡å¼åœ–å¡ï¼ˆæ—…ä¼´ + å…¥å¢ƒå¡ï¼‰ -->
        <div class="card" id="entryCard">
          <div class="entry-header">
            <div class="entry-title-block">
              <div class="entry-title">å…¥å¢ƒåœ–å¡ Â· Visit Japan Web</div>
              <div class="entry-subtitle">å¹«æ¯ä½æ—…ä¼´æ”¶é›†å…¥å¢ƒ QR / æˆªåœ–ï¼Œä¸æ€•æœ‰äººæ¼å­˜ã€‚</div>
            </div>
            <button class="pill-outline small" id="addTravelerBtn">ï¼‹ æ–°å¢æ—…ä¼´</button>
          </div>
          <div class="entry-list" id="travelerList">
            <!-- JS å‹•æ…‹æ³¨å…¥æ—…ä¼´ -->
          </div>
        </div>

        <!-- èµ°å¤±æ¨¡å¼åœ–å¡ -->
        <div class="card" id="lostCard" style="display:none;">
          <div class="lost-header">
            <div>
              <div class="lost-title">èµ°å¤±æ¨¡å¼ Â· æ—…ä¼´å®šä½</div>
              <div class="lost-subtitle">ä¸€éµå–å¾—ç›®å‰ä½ç½®ï¼Œç™¼å¸ƒçµ¦ä¸€èµ·ä½¿ç”¨æ­¤é é¢çš„æ—…ä¼´ã€‚</div>
              <div class="lost-status" id="locationStatus">
                å°šæœªå–å¾—ä½ç½®ã€‚å»ºè­°é–‹å•Ÿ GPS èˆ‡å®šä½æ¬Šé™ã€‚
              </div>
            </div>
          </div>

          <div class="lost-actions">
            <button class="btn-ghost" id="locateBtn">ğŸ“ å–å¾—ç›®å‰ä½ç½®</button>
            <button class="btn-primary" id="publishBtn">ğŸš¨ ç™¼å¸ƒä½ç½®çµ¦æ—…ä¼´</button>
          </div>

          <div class="lost-feed" id="locationFeed">
            <div class="lost-feed-empty">ç›®å‰å°šç„¡ä»»ä½•ä½ç½®ç™¼å¸ƒç´€éŒ„ã€‚</div>
          </div>
        </div>
      </section>

      <!-- è¡Œç¨‹ -->
      <section class="page" id="page-trip">
        <div class="section-title">Daily Plan</div>
        <div class="date-strip">
          <button class="date-pill active">D1 Â· 11/20</button>
          <button class="date-pill">D2 Â· 11/21</button>
          <button class="date-pill">D3 Â· 11/22</button>
          <button class="date-pill">D4 Â· 11/23</button>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:baseline;">
            <div>
              <div class="sub-text">09:00 â€“ 11:00</div>
              <div>å—å±±å¡”æ•£æ­¥ Â· Morning Walk</div>
            </div>
            <div class="sub-text">é¦–çˆ¾å¸‚ä¸­å€</div>
          </div>
          <div class="tag-row">
            <div class="tag">è‡ªé§•</div>
            <div class="tag">å« MapCode</div>
            <div class="tag">æ‹ç…§æ™¯é»</div>
          </div>
          <div class="card-actions-row">
            <button class="btn-primary">ä¸€éµå°èˆª</button>
            <button class="btn-ghost">æé†’ï¼šå‡ºç™¼å‰ 5 åˆ†é˜</button>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:baseline;">
            <div>
              <div class="sub-text">12:30 â€“ 14:00</div>
              <div>æ¢¨æ³°é™¢åˆé¤ Â· éŸ“ç‰›çƒ¤è‚‰</div>
            </div>
            <div class="sub-text">Line 6 Â· Itaewon</div>
          </div>
          <div class="tag-row">
            <div class="tag">åœ°éµ</div>
            <div class="tag">ç¾é£Ÿ</div>
          </div>
          <div class="card-actions-row">
            <button class="btn-primary">ä¸€éµå°èˆª</button>
            <button class="btn-ghost">æé†’ï¼šå‡ºç™¼å‰ 10 åˆ†é˜</button>
          </div>
        </div>
      </section>

      <!-- è¨˜å¸³ -->
      <section class="page" id="page-money">
        <div class="section-title">Expense Log</div>
        <div class="card">
          <div class="sub-text">åˆ†é¡ Category</div>
          <div class="chip-grid">
            <div class="chip-icon active">ğŸ™ é¤é£²</div>
            <div class="chip-icon">ğŸš† äº¤é€š</div>
            <div class="chip-icon">ğŸ›ï¸ è³¼ç‰©</div>
            <div class="chip-icon">ğŸŸï¸ é–€ç¥¨</div>
            <div class="chip-icon">ğŸ¨ ä½å®¿</div>
            <div class="chip-icon">â‹¯ å…¶ä»–</div>
          </div>

          <div class="two-col">
            <div style="flex: 1;">
              <div class="input-label">å¹£åˆ¥</div>
              <div class="pill-row">
                <button class="pill-outline active">KRW</button>
                <button class="pill-outline">TWD</button>
                <button class="pill-outline">JPY</button>
              </div>
            </div>
            <div style="flex: 1;">
              <div class="input-label">ä»˜æ¬¾äºº</div>
              <div class="pill-row">
                <button class="pill-outline active">æˆ‘</button>
                <button class="pill-outline">ç”·å‹</button>
                <button class="pill-outline">å…¬è²»</button>
              </div>
            </div>
          </div>

          <div class="input-row">
            <div class="input-label">é‡‘é¡</div>
            <input class="input-field" placeholder="è¼¸å…¥é‡‘é¡ï¼ˆä¾‹å¦‚ 48,000ï¼‰" />
            <div class="sub-text">ç´„ NT$ 1,176ï¼ˆä¾ç•¶ä¸‹åŒ¯ç‡ä¼°ç®—ï¼‰</div>
          </div>

          <div class="input-row">
            <div class="input-label">å‚™è¨»</div>
            <input class="input-field" placeholder="ä¾‹å¦‚ï¼šå¼˜å¤§çƒ¤è‚‰ Â· åˆé¤" />
          </div>

          <div class="input-row">
            <div class="input-label">åˆ†æ”¤æ–¹å¼</div>
            <div class="two-col">
              <button class="pill-outline active" style="flex: 1;">å…±åŒåˆ†æ”¤</button>
              <button class="pill-outline" style="flex: 1;">å€‹äººè‡ªä»˜</button>
            </div>
          </div>

          <div class="summary-bar">
            <span>ğŸ§®</span> ä»Šæ—¥ç´¯è¨ˆï¼šç°¡å“¥éœ€çµ¦ä½  â‚© 35,810ï¼ˆå¹³åˆ†å¾Œå·®é¡ï¼‰
          </div>

          <div style="margin-top: 14px; text-align: right;">
            <button class="btn-primary">æ–°å¢è¨˜éŒ„</button>
          </div>
        </div>
      </section>

      <!-- æ¸…å–® -->
      <section class="page" id="page-list">
        <div class="section-title">Packing Checklist</div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div>æ‰“åŒ…å®Œæˆåº¦ 72%</div>
              <div class="sub-text">é‚„æœ‰ 6 ä»¶ç‰©å“å°šæœªå‹¾é¸</div>
            </div>
            <button class="pill-outline small">é‡æ–°æ•´ç†</button>
          </div>
          <div style="margin-top:10px;">
            <div class="progress-track">
              <div class="progress-fill"></div>
            </div>
          </div>
        </div>

        <div class="section-title">è¡Œæåˆ†é¡</div>

        <div class="card">
          <div class="group-header">
            <div>ğŸ‘• è¡£ç‰© Â· CLOTHING</div>
            <div class="sub-text">5 / 8</div>
          </div>
          <div class="checklist">
            <label class="check-item">
              <input type="checkbox" checked />
              <span>å¤–å¥—</span>
            </label>
            <label class="check-item">
              <input type="checkbox" checked />
              <span>æ›æ´—ä¸Šè¡£ 3 ä»¶</span>
            </label>
            <label class="check-item">
              <input type="checkbox" checked />
              <span>ç¡è¡£</span>
            </label>
            <label class="check-item">
              <input type="checkbox" />
              <span>å‚™ç”¨è¥ªå­</span>
            </label>
          </div>
        </div>

        <div class="card">
          <div class="group-header">
            <div>ğŸ”Œ 3C & å……é›»</div>
            <div class="sub-text">3 / 5</div>
          </div>
          <div class="checklist">
            <label class="check-item">
              <input type="checkbox" checked />
              <span>æ‰‹æ©Ÿå……é›»ç·š</span>
            </label>
            <label class="check-item">
              <input type="checkbox" checked />
              <span>è¡Œå‹•é›»æº</span>
            </label>
            <label class="check-item">
              <input type="checkbox" />
              <span>ç›¸æ©Ÿé›»æ± </span>
            </label>
            <label class="check-item">
              <input type="checkbox" checked />
              <span>è½‰æ¥é ­</span>
            </label>
          </div>
        </div>
      </section>
    </main>

    <!-- bottom nav -->
    <div class="bottom-nav-wrap">
      <div class="bottom-nav">
        <div class="bottom-item active" data-tab-bottom="home">
          <div class="bottom-item-icon">ğŸ </div>
          <div>å®¶</div>
        </div>
        <div class="bottom-item" data-tab-bottom="trip">
          <div class="bottom-item-icon">ğŸ—ºï¸</div>
          <div>è¡Œç¨‹</div>
        </div>
        <div class="bottom-item" data-tab-bottom="money">
          <div class="bottom-item-icon">ğŸ’°</div>
          <div>è¨˜å¸³</div>
        </div>
        <div class="bottom-item" data-tab-bottom="list">
          <div class="bottom-item-icon">ğŸ§³</div>
          <div>æ¸…å–®</div>
        </div>
      </div>
    </div>

    <!-- æ–°å¢æ—…ä¼´ Modal -->
    <div class="modal-backdrop" id="nameModal">
      <div class="modal">
        <div class="modal-title">æ–°å¢æ—…ä¼´</div>
        <div class="modal-sub">è¼¸å…¥è¦é¡¯ç¤ºåœ¨é ­è²¼å…§çš„æš±ç¨±ï¼ˆæœ€å¤š 4 å€‹å­—ï¼‰</div>
        <input
          id="nameInput"
          class="input-field modal-input"
          maxlength="8"
          placeholder="ä¾‹å¦‚ï¼šæˆ‘ã€å°æœ±ã€ç°¡å“¥"
        />
        <div class="modal-actions">
          <button class="btn-ghost" id="cancelNameBtn">å–æ¶ˆ</button>
          <button class="btn-primary" id="confirmNameBtn">åŠ å…¥</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* tabs åŒæ­¥ */
    const tabs = document.querySelectorAll(".top-tab");
    const bottomItems = document.querySelectorAll(".bottom-item");
    const pages = {
      home: document.getElementById("page-home"),
      trip: document.getElementById("page-trip"),
      money: document.getElementById("page-money"),
      list: document.getElementById("page-list"),
    };

    function activateTab(key) {
      tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === key));
      bottomItems.forEach(b => b.classList.toggle("active", b.dataset.tabBottom === key));
      Object.entries(pages).forEach(([k, p]) => p.classList.toggle("active", k === key));
    }
    tabs.forEach(tab => tab.addEventListener("click", () => activateTab(tab.dataset.tab)));
    bottomItems.forEach(item => item.addEventListener("click", () => activateTab(item.dataset.tabBottom)));

    /* ä¸»é¡Œåˆ‡æ› */
    const themeBtn = document.getElementById("themeBtn");
    const themes = ["default", "lilac", "midnight"];
    let themeIndex = 0;
    function applyTheme() {
      const key = themes[themeIndex];
      if (key === "default") {
        document.documentElement.removeAttribute("data-theme");
        themeBtn.innerHTML = `<span>ğŸ¨</span> ORIGINAL`;
      } else if (key === "lilac") {
        document.documentElement.setAttribute("data-theme", "lilac");
        themeBtn.innerHTML = `<span>ğŸŒˆ</span> LILAC`;
      } else {
        document.documentElement.setAttribute("data-theme", "midnight");
        themeBtn.innerHTML = `<span>ğŸŒ™</span> MIDNIGHT`;
      }
    }
    applyTheme();
    themeBtn.addEventListener("click", () => {
      themeIndex = (themeIndex + 1) % themes.length;
      applyTheme();
    });

    /* åŒ¯ç‡ */
    const krwInput = document.getElementById("krwInput");
    const twdInput = document.getElementById("twdInput");
    const rateText = document.getElementById("rateText");
    const refreshRateBtn = document.getElementById("refreshRateBtn");
    const customRateRow = document.getElementById("customRateRow");
    const customRateInput = document.getElementById("customRateInput");
    const rateModeToggle = document.getElementById("rateModeToggle");
    const labelLive = document.getElementById("labelLive");
    const labelCustom = document.getElementById("labelCustom");

    let liveRateTWDToKRW = 45.0;
    let rateTWDToKRW = liveRateTWDToKRW;
    let rateMode = "live";
    let isUpdating = false;

    function updateRateText() {
      if (rateMode === "live") {
        rateText.textContent = "ç›®å‰ä½¿ç”¨å³æ™‚åŒ¯ç‡ï¼šç´„ 1 TWD â‰ˆ " + rateTWDToKRW.toFixed(2) + " KRW";
      } else {
        rateText.textContent = "";
      }
    }
    function updateSwitchLabels() {
      if (rateMode === "live") {
        labelLive.style.opacity = 0;
        labelCustom.style.opacity = 1;
      } else {
        labelLive.style.opacity = 1;
        labelCustom.style.opacity = 0;
      }
    }
    function applyModeUI() {
      if (rateMode === "live") {
        customRateRow.style.display = "none";
        rateText.style.display = "block";
        refreshRateBtn.style.display = "inline-flex";
      } else {
        customRateRow.style.display = "flex";
        rateText.style.display = "none";
        refreshRateBtn.style.display = "none";
      }
      updateRateText();
      updateSwitchLabels();
      recalcFromInputs();
    }
    function recalcFromInputs() {
      const vK = parseFloat(krwInput.value);
      const vT = parseFloat(twdInput.value);
      if (!isNaN(vK)) {
        isUpdating = true;
        twdInput.value = (vK / rateTWDToKRW).toFixed(0);
        isUpdating = false;
      } else if (!isNaN(vT)) {
        isUpdating = true;
        krwInput.value = (vT * rateTWDToKRW).toFixed(0);
        isUpdating = false;
      }
    }
    async function fetchRate() {
      try {
        rateText.textContent = "åŒ¯ç‡è¼‰å…¥ä¸­â€¦";
        const res = await fetch("https://open.er-api.com/v6/latest/KRW");
        const data = await res.json();
        if (data && data.result === "success" && data.rates && data.rates.TWD) {
          const twdPerKrw = data.rates.TWD;
          liveRateTWDToKRW = 1 / twdPerKrw;
          if (rateMode === "live") {
            rateTWDToKRW = liveRateTWDToKRW;
            updateRateText();
            recalcFromInputs();
          } else {
            rateText.textContent = "";
          }
        } else {
          rateText.textContent = "åŒ¯ç‡è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨é è¨­åŒ¯ç‡ã€‚";
        }
      } catch (e) {
        console.error(e);
        rateText.textContent = "åŒ¯ç‡è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨é è¨­åŒ¯ç‡ã€‚";
      }
    }
    fetchRate();
    applyModeUI();

    refreshRateBtn.addEventListener("click", () => { fetchRate(); });
    rateModeToggle.addEventListener("change", () => {
      rateMode = rateModeToggle.checked ? "custom" : "live";
      if (rateMode === "custom") {
        if (!customRateInput.value) {
          customRateInput.value = liveRateTWDToKRW.toFixed(2);
        }
        const v = parseFloat(customRateInput.value);
        if (!isNaN(v) && v > 0) rateTWDToKRW = v;
      } else {
        rateTWDToKRW = liveRateTWDToKRW;
      }
      applyModeUI();
    });
    customRateInput.addEventListener("input", () => {
      if (rateMode !== "custom") return;
      const v = parseFloat(customRateInput.value);
      if (isNaN(v) || v <= 0) return;
      rateTWDToKRW = v;
      recalcFromInputs();
    });
    krwInput.addEventListener("input", () => {
      if (isUpdating) return;
      const v = parseFloat(krwInput.value);
      if (isNaN(v)) {
        isUpdating = true;
        twdInput.value = "";
        isUpdating = false;
        return;
      }
      isUpdating = true;
      twdInput.value = (v / rateTWDToKRW).toFixed(0);
      isUpdating = false;
    });
    twdInput.addEventListener("input", () => {
      if (isUpdating) return;
      const v = parseFloat(twdInput.value);
      if (isNaN(v)) {
        isUpdating = true;
        krwInput.value = "";
        isUpdating = false;
        return;
      }
      isUpdating = true;
      krwInput.value = (v * rateTWDToKRW).toFixed(0);
      isUpdating = false;
    });

    /* å¤©æ°£ï¼šOpen-Meteo + SVG icons */
    const weatherRow = document.getElementById("weatherRow");

    function getWeatherIconSvg(code) {
      // 0: æ™´
      if (code === 0) {
        return `
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="4"></circle>
            <line x1="12" y1="2" x2="12" y2="4"></line>
            <line x1="12" y1="20" x2="12" y2="22"></line>
            <line x1="4" y1="12" x2="6" y2="12"></line>
            <line x1="18" y1="12" x2="20" y2="12"></line>
            <line x1="5" y1="5" x2="6.5" y2="6.5"></line>
            <line x1="17.5" y1="17.5" x2="19" y2="19"></line>
            <line x1="5" y1="19" x2="6.5" y2="17.5"></line>
            <line x1="17.5" y1="6.5" x2="19" y2="5"></line>
          </svg>`;
      }
      // 1â€“2: æ™´æ™‚å¤šé›²
      if ([1, 2].includes(code)) {
        return `
          <svg viewBox="0 0 24 24">
            <circle cx="7" cy="7" r="3"></circle>
            <line x1="7" y1="2" x2="7" y2="3.5"></line>
            <line x1="7" y1="10.5" x2="7" y2="12"></line>
            <line x1="2" y1="7" x2="3.5" y2="7"></line>
            <line x1="10.5" y1="7" x2="12" y2="7"></line>
            <path d="M7 16h8a3 3 0 0 0 0-6 4.2 4.2 0 0 0-7.6-1.7" />
          </svg>`;
      }
      // 3/45/48: å¤šé›²/éœ§
      if ([3, 45, 48].includes(code)) {
        return `
          <svg viewBox="0 0 24 24">
            <path d="M6 17h10a3 3 0 0 0 0-6 4.5 4.5 0 0 0-8.7-1.5A3.5 3.5 0 0 0 6 17z"></path>
          </svg>`;
      }
      // é›¨
      if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(code)) {
        return `
          <svg viewBox="0 0 24 24">
            <path d="M6 15h10a3 3 0 0 0 0-6 4.5 4.5 0 0 0-8.7-1.5A3.5 3.5 0 0 0 6 15z"></path>
            <line x1="9" y1="16.5" x2="7.5" y2="19"></line>
            <line x1="12" y1="17" x2="10.5" y2="19.5"></line>
            <line x1="15" y1="16.5" x2="13.5" y2="19"></line>
          </svg>`;
      }
      // é›ª
      if ([71, 73, 75, 77, 85, 86].includes(code)) {
        return `
          <svg viewBox="0 0 24 24">
            <path d="M6 15h10a3 3 0 0 0 0-6 4.5 4.5 0 0 0-8.7-1.5A3.5 3.5 0 0 0 6 15z"></path>
            <line x1="9" y1="17" x2="9" y2="19"></line>
            <line x1="8" y1="18" x2="10" y2="18"></line>
            <line x1="14" y1="17" x2="14" y2="19"></line>
            <line x1="13" y1="18" x2="15" y2="18"></line>
          </svg>`;
      }
      // é›·é›¨
      return `
        <svg viewBox="0 0 24 24">
          <path d="M6 14h10a3 3 0 0 0 0-6 4.5 4.5 0 0 0-8.7-1.5A3.5 3.5 0 0 0 6 14z"></path>
          <polyline points="11 15 9.5 19 13 18 11.5 22"></polyline>
        </svg>`;
    }

    async function fetchWeather() {
      try {
        weatherRow.innerHTML =
          `<div class="sub-text" style="flex:1;text-align:center;">å–å¾—å¤©æ°£è³‡æ–™ä¸­â€¦</div>`;

        const url =
          "https://api.open-meteo.com/v1/forecast?latitude=37.57&longitude=126.98&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FSeoul";

        const res = await fetch(url);
        const data = await res.json();
        if (!data.daily || !data.daily.time) throw new Error("No daily weather");

        const days = data.daily;
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        weatherRow.innerHTML = "";

        for (let i = 0; i < 5; i++) {
          const dateStr = days.time[i];
          const d = new Date(dateStr + "T00:00:00+09:00");

          const label = dayNames[d.getUTCDay()];
          const maxTemp = Math.round(days.temperature_2m_max[i]);
          const minTemp = Math.round(days.temperature_2m_min[i]);
          const code = days.weathercode[i];
          const svg = getWeatherIconSvg(code);

          const accentClass = i === 0 ? "weather-icon-svg accent" : "weather-icon-svg";

          const dayDiv = document.createElement("div");
          dayDiv.className = "weather-day";
          dayDiv.innerHTML = `
            <div>${label}</div>
            <div class="${accentClass}">${svg}</div>
            <div class="weather-temp-high">${maxTemp}Â°</div>
            <div class="weather-temp-low">${minTemp}Â°</div>
          `;
          weatherRow.appendChild(dayDiv);
        }
      } catch (e) {
        console.error(e);
        weatherRow.innerHTML =
          `<div class="sub-text" style="flex:1;text-align:center;">å¤©æ°£è³‡æ–™è¼‰å…¥å¤±æ•—</div>`;
      }
    }

    fetchWeather();

    /* å…¥å¢ƒæ¨¡å¼ / èµ°å¤±æ¨¡å¼ åˆ‡æ› */
    const modeSegment = document.getElementById("modeSegment");
    const modeButtons = modeSegment.querySelectorAll(".segment-btn");
    const entryCard = document.getElementById("entryCard");
    const lostCard = document.getElementById("lostCard");

    function setMode(mode) {
      modeButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.mode === mode);
      });
      if (mode === "entry") {
        entryCard.style.display = "block";
        lostCard.style.display = "none";
      } else {
        entryCard.style.display = "block"; // ä»ä¿ç•™åœ¨ DOM ä¸­ï¼Œåªæ˜¯ä¸‹æ–¹åˆ‡æ›å¡ç‰‡
        lostCard.style.display = "block";
      }
    }

    modeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        if (btn.dataset.mode === "entry") {
          entryCard.style.display = "block";
          lostCard.style.display = "none";
        } else {
          entryCard.style.display = "none";
          lostCard.style.display = "block";
        }
        modeButtons.forEach(b => b.classList.toggle("active", b === btn));
      });
    });

    /* èµ°å¤±æ¨¡å¼ Â· æ—…ä¼´å®šä½ï¼ˆå‰ç«¯ prototypeï¼‰*/
    const locateBtn = document.getElementById("locateBtn");
    const publishBtn = document.getElementById("publishBtn");
    const locationStatus = document.getElementById("locationStatus");
    const locationFeed = document.getElementById("locationFeed");

    let currentPosition = null;
    let locationPosts = [];

    function loadLocationFeed() {
      try {
        const raw = localStorage.getItem("ktm_lost_locations");
        if (!raw) {
          locationPosts = [];
        } else {
          locationPosts = JSON.parse(raw);
        }
      } catch (e) {
        locationPosts = [];
      }
      renderLocationFeed();
    }

    function saveLocationFeed() {
      try {
        localStorage.setItem("ktm_lost_locations", JSON.stringify(locationPosts));
      } catch (e) {
        console.error(e);
      }
    }

    function renderLocationFeed() {
      locationFeed.innerHTML = "";
      if (!locationPosts.length) {
        locationFeed.innerHTML = `<div class="lost-feed-empty">ç›®å‰å°šç„¡ä»»ä½•ä½ç½®ç™¼å¸ƒç´€éŒ„ã€‚</div>`;
        return;
      }
      locationPosts
        .slice()
        .reverse()
        .forEach(item => {
          const div = document.createElement("div");
          div.className = "lost-item";
          const timeStr = new Date(item.timestamp).toLocaleString();
          const mapUrl = `https://maps.google.com/?q=${item.lat},${item.lng}`;
          div.innerHTML = `
            <div><strong>${item.name || "æ—…ä¼´"}</strong> Â· ${timeStr}</div>
            <div>åº§æ¨™ï¼š${item.lat.toFixed(5)}, ${item.lng.toFixed(5)}ï¼ˆèª¤å·®ç´„ ${Math.round(item.accuracy)}mï¼‰</div>
            <div><a href="${mapUrl}" target="_blank" rel="noopener noreferrer">åœ¨åœ°åœ–ä¸­é–‹å•Ÿ</a></div>
          `;
          locationFeed.appendChild(div);
        });
    }

    locateBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        locationStatus.textContent = "æ­¤è£ç½®ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚";
        return;
      }
      locationStatus.textContent = "å–å¾—å®šä½ä¸­â€¦";
      navigator.geolocation.getCurrentPosition(
        pos => {
          const { latitude, longitude, accuracy } = pos.coords;
          currentPosition = { lat: latitude, lng: longitude, accuracy };
          locationStatus.textContent =
            `å·²å–å¾—ç›®å‰ä½ç½®ï¼š${latitude.toFixed(5)}, ${longitude.toFixed(5)}ï¼ˆèª¤å·®ç´„ ${Math.round(accuracy)}mï¼‰`;
        },
        err => {
          console.error(err);
          if (err.code === 1) {
            locationStatus.textContent = "å®šä½è¢«æ‹’çµ•ï¼Œè«‹åœ¨ç€è¦½å™¨æˆ–ç³»çµ±è¨­å®šä¸­é–‹å•Ÿå®šä½æ¬Šé™ã€‚";
          } else if (err.code === 2) {
            locationStatus.textContent = "ç„¡æ³•å–å¾—ä½ç½®ï¼ˆè¨Šè™Ÿä¸ä½³æˆ–è£ç½®æ²’æœ‰ GPSï¼‰ã€‚";
          } else {
            locationStatus.textContent = "å–å¾—ä½ç½®æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚";
          }
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0,
        }
      );
    });

    publishBtn.addEventListener("click", () => {
      if (!currentPosition) {
        locationStatus.textContent = "è«‹å…ˆé»æ“Šã€Œå–å¾—ç›®å‰ä½ç½®ã€ã€‚";
        return;
      }
      const name = "æ—…ä¼´"; // æœªä¾†å¯é…åˆæ—…ä¼´æš±ç¨±
      const post = {
        name,
        lat: currentPosition.lat,
        lng: currentPosition.lng,
        accuracy: currentPosition.accuracy,
        timestamp: Date.now(),
      };
      locationPosts.push(post);
      saveLocationFeed();
      renderLocationFeed();
      locationStatus.textContent = "ä½ç½®å·²ç™¼å¸ƒï¼Œæ—…ä¼´é‡æ–°è¼‰å…¥æ­¤é å³å¯çœ‹åˆ°æœ€æ–°ç´€éŒ„ã€‚";
    });

    loadLocationFeed();

    /* å…¥å¢ƒæ¨¡å¼ï¼šæ—…ä¼´ + å…¥å¢ƒå¡ */
    const travelerList = document.getElementById("travelerList");
    const addTravelerBtn = document.getElementById("addTravelerBtn");
    const nameModal = document.getElementById("nameModal");
    const nameInput = document.getElementById("nameInput");
    const cancelNameBtn = document.getElementById("cancelNameBtn");
    const confirmNameBtn = document.getElementById("confirmNameBtn");

    let travelerIdCounter = 0;
    let travelers = [];

    function openNameModal() {
      nameModal.style.display = "flex";
      nameInput.value = "";
      nameInput.focus();
    }
    function closeNameModal() {
      nameModal.style.display = "none";
    }

    cancelNameBtn.addEventListener("click", closeNameModal);
    nameModal.addEventListener("click", (e) => {
      if (e.target === nameModal) closeNameModal();
    });

    confirmNameBtn.addEventListener("click", () => {
      const raw = nameInput.value.trim();
      const name = raw || `æ—…ä¼´ ${travelers.length + 1}`;
      addTraveler(name);
      closeNameModal();
    });

    nameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        confirmNameBtn.click();
      }
    });

    addTravelerBtn.addEventListener("click", openNameModal);

    function createTravelerElement(traveler) {
      const wrapper = document.createElement("div");
      wrapper.className = "traveler-card";
      wrapper.dataset.id = traveler.id;

      const initials = traveler.name.length > 4 ? traveler.name.slice(0, 4) : traveler.name;

      wrapper.innerHTML = `
        <div class="traveler-head">
          <div class="traveler-avatar">
            <span>${initials}</span>
          </div>
          <div class="traveler-info">
            <div class="traveler-name">${traveler.name}</div>
            <div class="sub-text" data-role="status">
              ${traveler.image ? "å·²ä¸Šå‚³å…¥å¢ƒå¡åœ–ç‰‡" : "å…¥å¢ƒå¡å°šæœªä¸Šå‚³"}
            </div>
          </div>
        </div>
        <div class="entry-upload">
          <div class="entry-preview" data-role="preview">
            ${
              traveler.image
                ? `<img src="${traveler.image}" alt="å…¥å¢ƒå¡é è¦½" />`
                : `<span class="entry-preview-placeholder">å°šæœªé¸æ“‡åœ–ç‰‡ Â· å¯ç”¨ä¾†æ”¾ QR æˆªåœ–æˆ–æ‹ç…§</span>`
            }
          </div>
          <div class="entry-upload-actions">
            <label class="btn-ghost">
              ğŸ“· æ‹ç…§ / ä¸Šå‚³
              <input
                type="file"
                accept="image/*"
                capture="environment"
                class="entry-file-input"
                hidden
              />
            </label>
          </div>
        </div>
      `;

      const fileInput = wrapper.querySelector(".entry-file-input");
      const preview = wrapper.querySelector('[data-role="preview"]');
      const statusText = wrapper.querySelector('[data-role="status"]');

      fileInput.addEventListener("change", () => {
        const file = fileInput.files && fileInput.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          const url = e.target.result;
          traveler.image = url;
          preview.innerHTML = `<img src="${url}" alt="å…¥å¢ƒå¡é è¦½" />`;
          statusText.textContent = "å·²ä¸Šå‚³å…¥å¢ƒå¡åœ–ç‰‡";
        };
        reader.readAsDataURL(file);
      });

      return wrapper;
    }

    function renderTravelers() {
      travelerList.innerHTML = "";
      travelers.forEach(t => {
        travelerList.appendChild(createTravelerElement(t));
      });
      if (!travelers.length) {
        const empty = document.createElement("div");
        empty.className = "sub-text";
        empty.textContent = "ç›®å‰å°šæœªæ–°å¢ä»»ä½•æ—…ä¼´ã€‚";
        travelerList.appendChild(empty);
      }
    }

    function addTraveler(name) {
      const t = {
        id: "traveler_" + (++travelerIdCounter),
        name,
        image: null,
      };
      travelers.push(t);
      renderTravelers();
    }

    // åˆå§‹é è¨­ä¸€ä½ã€Œæˆ‘ã€
    addTraveler("æˆ‘");

    /* é–ç¸®æ”¾ï¼ˆiOSï¼‰ */
    (function lockZoom() {
      const vp = document.querySelector('meta[name="viewport"]');
      if (vp) {
        vp.setAttribute(
          "content",
          "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        );
      }
      document.addEventListener("gesturestart", e => e.preventDefault(), { passive: false });
      document.addEventListener("gesturechange", e => e.preventDefault(), { passive: false });
      document.addEventListener("gestureend", e => e.preventDefault(), { passive: false });
      let lastTouchEnd = 0;
      document.addEventListener(
        "touchend",
        e => {
          const now = Date.now();
          if (now - lastTouchEnd <= 300) e.preventDefault();
          lastTouchEnd = now;
        },
        { passive: false }
      );
    })();
  </script>
</body>
</html>
